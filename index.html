<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Quiz Master - Smart MCQ Extractor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #FF6B6B;
            --primary-light: #FF8E8E;
            --primary-dark: #FF5252;
            --secondary: #4ECDC4;
            --accent: #FFD166;
            --success: #06D6A0;
            --warning: #FF9A3D;
            --danger: #EF476F;
            --info: #118AB2;
            --light: #F8F9FA;
            --dark: #2D3047;
            --gray: #8D99AE;
            --gray-light: #EDF2F4;
            --purple: #7209B7;
            --blue: #4361EE;
            --border-radius: 20px;
            --box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --sidebar-width: 280px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            min-height: 100vh;
            transition: var(--transition);
            overflow-x: hidden;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #141E30 0%, #243B55 100%);
            color: var(--light);
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: var(--box-shadow);
            padding: 1.2rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
            border-bottom: 3px solid var(--primary);
        }

        .dark-mode .header {
            background: rgba(45, 48, 71, 0.95);
            border-bottom-color: var(--accent);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 900;
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        .logo i {
            font-size: 2.2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 1.2rem;
            align-items: center;
        }

        .theme-toggle, .drawer-toggle, .home-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            color: white;
            border: none;
            width: 52px;
            height: 52px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.4rem;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        }

        .home-btn {
            background: linear-gradient(135deg, var(--info) 0%, var(--blue) 100%);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }

        .theme-toggle:hover, .drawer-toggle:hover, .home-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 12px 25px rgba(255, 107, 107, 0.4);
        }

        /* Main Layout */
        .main-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar/Drawer */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 2.5rem 2rem;
            overflow-y: auto;
            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.1);
            transform: translateX(-100%);
            transition: var(--transition);
            position: fixed;
            top: 80px;
            bottom: 0;
            z-index: 999;
            border-right: 3px solid var(--primary);
        }

        .dark-mode .sidebar {
            background: rgba(45, 48, 71, 0.95);
            border-right-color: var(--accent);
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-buttons {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            margin-top: 2rem;
        }

        .sidebar-btn {
            padding: 1.2rem;
            border-radius: 15px;
            background: linear-gradient(135deg, var(--info) 0%, var(--blue) 100%);
            border: none;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
            text-align: left;
        }

        .sidebar-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 25px rgba(67, 97, 238, 0.4);
        }

        .sidebar-btn:nth-child(2) {
            background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%);
            box-shadow: 0 8px 20px rgba(255, 209, 102, 0.3);
        }

        .sidebar-btn:nth-child(3) {
            background: linear-gradient(135deg, var(--success) 0%, var(--secondary) 100%);
            box-shadow: 0 8px 20px rgba(6, 214, 160, 0.3);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 3rem;
            transition: var(--transition);
            width: 100%;
            position: relative;
        }

        .sidebar.open + .main-content {
            margin-left: var(--sidebar-width);
        }

        /* Home/Library Section */
        .home-section {
            display: block;
        }

        .library-section {
            display: none;
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 5rem 4rem;
            text-align: center;
            box-shadow: var(--box-shadow);
            margin-bottom: 3rem;
            border: 4px dashed var(--primary);
            transition: var(--transition);
            animation: fadeIn 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }

        .upload-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--secondary), var(--info));
        }

        .dark-mode .upload-section {
            background: rgba(45, 48, 71, 0.95);
            border-color: var(--accent);
        }

        .upload-section:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .upload-icon {
            font-size: 6rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 2rem;
            animation: float 4s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(5deg); }
            66% { transform: translateY(10px) rotate(-5deg); }
        }

        .upload-title {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 900;
            text-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .upload-desc {
            color: var(--dark);
            margin-bottom: 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            font-size: 1.3rem;
            line-height: 1.8;
            padding: 0 2rem;
        }

        .dark-mode .upload-desc {
            color: var(--gray-light);
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin-bottom: 2.5rem;
        }

        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-label {
            display: inline-block;
            padding: 1.5rem 3.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            color: white;
            border-radius: 60px;
            font-weight: 800;
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 12px 30px rgba(255, 107, 107, 0.4);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .file-label:hover {
            transform: translateY(-8px) scale(1.08);
            box-shadow: 0 20px 40px rgba(255, 107, 107, 0.5);
        }

        .extract-btn {
            padding: 1.5rem 4rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%);
            color: white;
            border: none;
            border-radius: 60px;
            font-weight: 800;
            font-size: 1.4rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 12px 30px rgba(255, 209, 102, 0.4);
            display: inline-flex;
            align-items: center;
            gap: 20px;
        }

        .extract-btn:hover:not(:disabled) {
            transform: translateY(-8px) scale(1.08);
            box-shadow: 0 20px 40px rgba(255, 209, 102, 0.5);
        }

        .extract-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .loading {
            display: inline-block;
            width: 28px;
            height: 28px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .file-info {
            margin-top: 1.5rem;
            color: var(--primary);
            font-size: 1.1rem;
            font-weight: 600;
            padding: 1rem 2rem;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 15px;
            display: inline-block;
            border: 2px solid rgba(255, 107, 107, 0.3);
        }

        /* Library Section */
        .library-title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 900;
        }

        .library-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .pdf-folder {
            background: linear-gradient(135deg, #F8FAFC 0%, #EDF2F7 100%);
            border-radius: 20px;
            padding: 2.5rem;
            cursor: pointer;
            transition: var(--transition);
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }

        .pdf-folder::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 8px;
            height: 100%;
            background: linear-gradient(180deg, var(--primary), var(--accent));
        }

        .dark-mode .pdf-folder {
            background: linear-gradient(135deg, #4A5568 0%, #2D3748 100%);
        }

        .pdf-folder:hover {
            transform: translateY(-15px) scale(1.03);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }

        .folder-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .folder-icon {
            font-size: 3rem;
            color: var(--primary);
        }

        .folder-actions {
            display: flex;
            gap: 10px;
        }

        .folder-action-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid var(--primary);
            color: var(--primary);
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .folder-action-btn:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .folder-name {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 1rem;
            color: var(--dark);
            line-height: 1.4;
        }

        .dark-mode .folder-name {
            color: white;
        }

        .folder-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px dashed rgba(0,0,0,0.1);
        }

        .dark-mode .folder-meta {
            border-top-color: rgba(255,255,255,0.1);
        }

        .meta-item {
            text-align: center;
            flex: 1;
        }

        .meta-value {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--primary);
            display: block;
        }

        .meta-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 0.5rem;
        }

        .dark-mode .meta-label {
            color: #CBD5E0;
        }

        .performance-chart {
            height: 150px;
            margin-top: 1.5rem;
            position: relative;
        }

        .no-quizzes {
            text-align: center;
            padding: 4rem;
            color: var(--gray);
        }

        .no-quizzes i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        /* Quiz Selection Section */
        .quiz-selection-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 4rem;
            box-shadow: var(--box-shadow);
            margin-bottom: 2rem;
            animation: slideUp 0.8s ease-out;
            position: relative;
            overflow: hidden;
        }

        .quiz-selection-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--secondary), var(--success), var(--info));
        }

        .dark-mode .quiz-selection-section {
            background: rgba(45, 48, 71, 0.95);
        }

        .selection-title {
            font-size: 2.5rem;
            margin-bottom: 3rem;
            text-align: center;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--info) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 900;
        }

        .back-to-library {
            margin-bottom: 2rem;
        }

        .back-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--gray-light) 0%, #E2E8F0 100%);
            border: none;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .dark-mode .back-btn {
            background: linear-gradient(135deg, #4A5568 0%, #2D3748 100%);
            color: white;
        }

        .back-btn:hover {
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }

        .subject-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .subject-filter {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--gray-light) 0%, #E2E8F0 100%);
            border: none;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark);
        }

        .dark-mode .subject-filter {
            background: linear-gradient(135deg, #4A5568 0%, #2D3748 100%);
            color: var(--light);
        }

        .subject-filter:hover, .subject-filter.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }

        .quiz-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .quiz-card {
            background: linear-gradient(135deg, #F8FAFC 0%, #EDF2F7 100%);
            border-radius: 20px;
            padding: 2.5rem;
            cursor: pointer;
            transition: var(--transition);
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }

        .quiz-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 8px;
            height: 100%;
            background: linear-gradient(180deg, var(--primary), var(--accent));
        }

        .dark-mode .quiz-card {
            background: linear-gradient(135deg, #4A5568 0%, #2D3748 100%);
        }

        .quiz-card:hover {
            transform: translateY(-15px) scale(1.03);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }

        .quiz-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .quiz-number {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .quiz-badge {
            padding: 0.5rem 1.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%);
            color: var(--dark);
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .quiz-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 1rem;
            color: var(--dark);
            line-height: 1.4;
        }

        .dark-mode .quiz-title {
            color: white;
        }

        .quiz-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px dashed rgba(0,0,0,0.1);
        }

        .dark-mode .quiz-meta {
            border-top-color: rgba(255,255,255,0.1);
        }

        .quiz-performance {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            text-align: center;
        }

        .dark-mode .quiz-performance {
            background: rgba(255, 255, 255, 0.1);
        }

        .performance-score {
            font-size: 2rem;
            font-weight: 900;
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .performance-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* Quiz Section */
        .quiz-section {
            display: none;
            animation: slideUp 0.8s ease-out;
            position: relative;
        }

        .quiz-navigator-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--info) 0%, var(--blue) 100%);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.3rem;
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
            z-index: 100;
        }

        .quiz-navigator-toggle:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .quiz-navigator-toggle {
                display: flex;
            }
        }

        .quiz-navigator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--box-shadow);
            border: 3px solid var(--primary);
            width: 400px;
            max-height: 500px;
            overflow-y: auto;
            z-index: 99;
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .dark-mode .quiz-navigator {
            background: rgba(45, 48, 71, 0.95);
            border-color: var(--accent);
        }

        @media (max-width: 768px) {
            .quiz-navigator {
                display: none;
                right: 80px;
                width: calc(100vw - 140px);
                max-width: 400px;
            }
            
            .quiz-navigator.show {
                display: block;
            }
        }

        .navigator-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .question-bubble {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--gray-light) 0%, #E2E8F0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark);
            border: 2px solid transparent;
        }

        .dark-mode .question-bubble {
            background: linear-gradient(135deg, #4A5568 0%, #2D3748 100%);
            color: white;
        }

        .question-bubble:hover {
            transform: scale(1.1);
            border-color: var(--primary);
        }

        .question-bubble.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
            transform: scale(1.1);
        }

        .question-bubble.answered {
            background: linear-gradient(135deg, var(--success) 0%, var(--secondary) 100%);
            color: white;
        }

        .question-bubble.wrong {
            background: linear-gradient(135deg, var(--danger) 0%, #FF4D6D 100%);
            color: white;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            padding: 2.5rem;
            border-radius: 25px;
            box-shadow: var(--box-shadow);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .quiz-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }

        .quiz-info {
            flex: 1;
            z-index: 1;
        }

        .quiz-title-main {
            font-size: 2.2rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .quiz-subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quiz-stats {
            display: flex;
            gap: 2rem;
            z-index: 1;
        }

        .stat-box {
            text-align: center;
            padding: 1.5rem 2rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            min-width: 140px;
            border: 2px solid rgba(255,255,255,0.2);
            transition: var(--transition);
        }

        .stat-box:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-8px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 600;
        }

        .timer {
            font-size: 2.2rem;
            font-weight: 900;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 1.2rem 2.5rem;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            z-index: 1;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .timer.warning {
            background: rgba(255, 154, 61, 0.3);
            animation: pulseFast 1s infinite;
        }

        @keyframes pulseFast {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .question-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 3.5rem;
            box-shadow: var(--box-shadow);
            margin-bottom: 3rem;
            animation: slideIn 0.6s ease-out;
            border: 3px solid transparent;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .question-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--accent), var(--warning), var(--primary));
        }

        .dark-mode .question-container {
            background: rgba(45, 48, 71, 0.95);
            border-color: var(--accent);
        }

        .question-container:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 3px solid rgba(0,0,0,0.1);
        }

        .dark-mode .question-header {
            border-bottom-color: rgba(255,255,255,0.1);
        }

        .question-number {
            font-size: 1.6rem;
            font-weight: 900;
            color: var(--primary);
            background: rgba(255, 107, 107, 0.1);
            padding: 1rem 2rem;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 2px solid rgba(255, 107, 107, 0.3);
        }

        .dark-mode .question-number {
            background: rgba(255, 107, 107, 0.2);
            color: #FFB3B3;
        }

        .question-text {
            font-size: 1.5rem;
            line-height: 1.8;
            margin-bottom: 3rem;
            color: var(--dark);
            padding: 2rem;
            background: linear-gradient(135deg, #F8FAFC 0%, #EDF2F7 100%);
            border-radius: 20px;
            border-left: 8px solid var(--primary);
            font-weight: 500;
        }

        .dark-mode .question-text {
            color: white;
            background: linear-gradient(135deg, #4A5568 0%, #2D3748 100%);
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 768px) {
            .options-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option {
            padding: 1.8rem;
            border: 3px solid var(--gray-light);
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 25px;
            font-weight: 600;
            background: white;
            position: relative;
            overflow: hidden;
            font-size: 1.2rem;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1));
            transition: width 0.5s ease;
        }

        .dark-mode .option {
            border-color: #4A5568;
            background: #2D3748;
        }

        .option:hover::before {
            width: 100%;
        }

        .option:hover {
            border-color: var(--primary);
            transform: translateX(15px) translateY(-5px);
            box-shadow: 0 15px 30px rgba(255, 107, 107, 0.15);
        }

        .option.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
            transform: translateX(10px);
        }

        .option.correct {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(6, 214, 160, 0.1) 0%, rgba(6, 214, 160, 0.05) 100%);
            animation: correctPulse 0.6s ease-out;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        .option.incorrect {
            border-color: var(--danger);
            background: linear-gradient(135deg, rgba(239, 71, 111, 0.1) 0%, rgba(239, 71, 111, 0.05) 100%);
            animation: shake 0.6s ease-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .option-letter {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--gray-light) 0%, #E2E8F0 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.5rem;
            flex-shrink: 0;
            transition: var(--transition);
            color: var(--dark);
        }

        .dark-mode .option-letter {
            background: linear-gradient(135deg, #4A5568 0%, #2D3748 100%);
            color: white;
        }

        .option.selected .option-letter {
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            color: white;
            transform: rotate(15deg) scale(1.1);
        }

        .option.correct .option-letter {
            background: linear-gradient(135deg, var(--success) 0%, var(--secondary) 100%);
            color: white;
        }

        .option.incorrect .option-letter {
            background: linear-gradient(135deg, var(--danger) 0%, #FF4D6D 100%);
            color: white;
        }

        .solution-container {
            background: linear-gradient(135deg, rgba(255, 209, 102, 0.1) 0%, rgba(255, 209, 102, 0.05) 100%);
            border-radius: 20px;
            padding: 2.5rem;
            margin-top: 2rem;
            border-left: 8px solid var(--accent);
            display: none;
            animation: slideIn 0.6s ease-out;
        }

        .dark-mode .solution-container {
            background: linear-gradient(135deg, rgba(255, 209, 102, 0.2) 0%, rgba(255, 209, 102, 0.1) 100%);
        }

        .solution-title {
            font-weight: 900;
            margin-bottom: 1.5rem;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5rem;
        }

        .solution-text {
            line-height: 1.8;
            color: var(--dark);
            font-size: 1.3rem;
            font-weight: 500;
        }

        .dark-mode .solution-text {
            color: white;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            gap: 2rem;
        }

        .quiz-btn {
            padding: 1.2rem 2.8rem;
            border: none;
            border-radius: 15px;
            font-weight: 800;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }

        .quiz-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .quiz-btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% { transform: scale(0, 0); opacity: 0.5; }
            100% { transform: scale(50, 50); opacity: 0; }
        }

        .quiz-btn.prev {
            background: linear-gradient(135deg, var(--gray-light) 0%, #E2E8F0 100%);
            color: var(--dark);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .dark-mode .quiz-btn.prev {
            background: linear-gradient(135deg, #4A5568 0%, #2D3748 100%);
            color: white;
        }

        .quiz-btn.prev:hover:not(:disabled) {
            transform: translateX(-10px) translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .quiz-btn.next {
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        }

        .quiz-btn.next:hover:not(:disabled) {
            transform: translateX(10px) translateY(-5px);
            box-shadow: 0 15px 30px rgba(255, 107, 107, 0.4);
        }

        .quiz-btn.submit {
            background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%);
            color: var(--dark);
            box-shadow: 0 8px 20px rgba(255, 209, 102, 0.3);
        }

        .quiz-btn.submit:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 30px rgba(255, 209, 102, 0.4);
        }

        .quiz-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Results Section */
        .results-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 5rem;
            box-shadow: var(--box-shadow);
            text-align: center;
            animation: fadeIn 0.8s ease-out;
            position: relative;
            overflow: hidden;
        }

        .results-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success), var(--info));
        }

        .dark-mode .results-section {
            background: rgba(45, 48, 71, 0.95);
        }

        .results-icon {
            font-size: 8rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 2rem;
            animation: bounce 1.2s ease-out;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            30% { transform: translateY(-30px); }
            50% { transform: translateY(0); }
            70% { transform: translateY(-15px); }
        }

        .results-title {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 900;
        }

        .score-display {
            font-size: 6rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--accent), var(--success));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin: 3rem 0;
            text-shadow: 0 6px 30px rgba(0,0,0,0.2);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(255, 107, 107, 0.3); }
            to { text-shadow: 0 0 40px rgba(255, 107, 107, 0.6), 0 0 60px rgba(255, 107, 107, 0.4); }
        }

        .results-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin: 4rem 0;
            flex-wrap: wrap;
        }

        .result-stat {
            padding: 2.5rem;
            min-width: 220px;
            border-radius: 20px;
            background: white;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            border: 3px solid transparent;
        }

        .result-stat:hover {
            transform: translateY(-15px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .dark-mode .result-stat {
            background: #4A5568;
        }

        .result-stat.correct {
            background: linear-gradient(135deg, var(--success) 0%, var(--secondary) 100%);
            color: white;
            border-color: var(--success);
        }

        .result-stat.incorrect {
            background: linear-gradient(135deg, var(--danger) 0%, #FF4D6D 100%);
            color: white;
            border-color: var(--danger);
        }

        .result-stat .value {
            font-size: 4rem;
            font-weight: 900;
            display: block;
            margin-bottom: 0.5rem;
        }

        .wrong-questions-container {
            max-height: 500px;
            overflow-y: auto;
            margin: 3rem 0;
            padding: 2rem;
            background: linear-gradient(135deg, #F8FAFC 0%, #EDF2F7 100%);
            border-radius: 20px;
            border: 3px solid var(--gray-light);
        }

        .dark-mode .wrong-questions-container {
            background: linear-gradient(135deg, #4A5568 0%, #2D3748 100%);
            border-color: #4A5568;
        }

        .result-actions {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 4rem;
            flex-wrap: wrap;
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.4s ease-out;
        }

        .overlay-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 4rem;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
            animation: scaleIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .overlay-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success));
        }

        .dark-mode .overlay-content {
            background: #2D3047;
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .overlay-title {
            font-size: 2.2rem;
            margin-bottom: 2rem;
            color: var(--primary);
            font-weight: 900;
        }

        .overlay-text {
            margin-bottom: 3rem;
            line-height: 1.8;
            color: var(--dark);
            font-size: 1.2rem;
        }

        .dark-mode .overlay-text {
            color: white;
        }

        .overlay-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1.5rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                width: 300px;
            }
            
            .sidebar.open + .main-content {
                margin-left: 300px;
            }
            
            .quiz-cards-container, .library-container {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }

        @media (max-width: 992px) {
            .main-content {
                padding: 2rem;
            }
            
            .quiz-header {
                flex-direction: column;
                gap: 2rem;
                text-align: center;
            }
            
            .quiz-stats {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .stat-box {
                min-width: 120px;
            }
            
            .quiz-title-main {
                justify-content: center;
            }
            
            .quiz-navigator {
                width: 350px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .logo span {
                font-size: 1.5rem;
            }
            
            .upload-section {
                padding: 3rem 2rem;
            }
            
            .upload-title {
                font-size: 2.2rem;
            }
            
            .upload-desc {
                font-size: 1.1rem;
                padding: 0;
            }
            
            .quiz-selection-section, .library-section {
                padding: 2rem;
            }
            
            .selection-title, .library-title {
                font-size: 2rem;
            }
            
            .quiz-cards-container, .library-container {
                grid-template-columns: 1fr;
            }
            
            .quiz-card, .pdf-folder {
                padding: 2rem;
            }
            
            .quiz-header {
                padding: 2rem;
            }
            
            .question-container {
                padding: 2rem;
            }
            
            .question-text {
                font-size: 1.3rem;
                padding: 1.5rem;
            }
            
            .option {
                padding: 1.5rem;
            }
            
            .option-letter {
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
            
            .quiz-controls {
                flex-direction: column;
            }
            
            .quiz-btn {
                width: 100%;
                justify-content: center;
            }
            
            .results-section {
                padding: 3rem;
            }
            
            .score-display {
                font-size: 4.5rem;
            }
            
            .results-stats {
                gap: 1.5rem;
            }
            
            .result-stat {
                min-width: 160px;
                padding: 2rem;
            }
        }

        @media (max-width: 576px) {
            .logo span {
                display: none;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .sidebar.open + .main-content {
                margin-left: 0;
                display: none;
            }
            
            .upload-title {
                font-size: 1.8rem;
            }
            
            .file-label, .extract-btn {
                width: 100%;
                justify-content: center;
                font-size: 1.1rem;
                padding: 1.2rem 2rem;
            }
            
            .question-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .question-bubble {
                width: 42px;
                height: 42px;
            }
            
            .quiz-navigator {
                width: calc(100vw - 100px);
                right: 70px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo" id="homeLogo">
            <i class="fas fa-brain"></i>
            <span>Smart PDF Quiz Master</span>
        </div>
        <div class="header-actions">
            <button class="home-btn" id="homeBtn" title="Home">
                <i class="fas fa-home"></i>
            </button>
            <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="drawer-toggle" id="drawerToggle" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar/Drawer -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-buttons">
                <button class="sidebar-btn" id="themeBtn">
                    <i class="fas fa-palette"></i> Change Theme
                </button>
                <button class="sidebar-btn" id="shareBtn">
                    <i class="fas fa-share-alt"></i> Share App
                </button>
                <button class="sidebar-btn" id="aboutBtn">
                    <i class="fas fa-info-circle"></i> About & Help
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Home/Library Section -->
            <div class="home-section" id="homeSection">
                <!-- Upload Section -->
                <section class="upload-section" id="uploadSection">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <h1 class="upload-title">Smart PDF Quiz Extractor</h1>
                    <p class="upload-desc">
                        Upload any PDF containing questions (Q.1, Q.2, etc.) and solutions (Sol.1, Sol.2, etc.).
                        Our intelligent system automatically detects subjects, topics, and organizes questions
                        into beautiful 25-question quizzes with detailed analytics and performance tracking.
                    </p>
                    
                    <div class="file-input-wrapper">
                        <input type="file" id="pdfFileInput" class="file-input" accept=".pdf">
                        <label for="pdfFileInput" class="file-label">
                            <i class="fas fa-cloud-upload-alt"></i> Choose PDF File
                        </label>
                    </div>
                    
                    <p class="file-info" id="fileInfo">No file selected</p>
                    
                    <button class="extract-btn" id="extractBtn" disabled>
                        <span>Extract & Organize Questions</span>
                        <div class="loading" id="loadingIndicator" style="display: none;"></div>
                    </button>
                </section>

                <!-- Library Section -->
                <section class="library-section" id="librarySection">
                    <h2 class="library-title">Your PDF Library</h2>
                    <div class="library-container" id="libraryContainer">
                        <!-- PDF folders will be added here -->
                    </div>
                    <div class="no-quizzes" id="noQuizzesMessage" style="display: none;">
                        <i class="fas fa-folder-open"></i>
                        <h3>No PDFs in your library yet</h3>
                        <p>Upload a PDF to get started!</p>
                    </div>
                </section>
            </div>

            <!-- Quiz Selection Section -->
            <section class="quiz-selection-section" id="quizSelectionSection">
                <div class="back-to-library">
                    <button class="back-btn" id="backToLibraryBtn">
                        <i class="fas fa-arrow-left"></i> Back to Library
                    </button>
                </div>
                <h2 class="selection-title">Select Your Quiz</h2>
                <div class="subject-filters" id="subjectFilters">
                    <!-- Subject filters will be added here -->
                </div>
                <div class="quiz-cards-container" id="quizCardsContainer">
                    <!-- Quiz cards will be added here -->
                </div>
            </section>

            <!-- Quiz Section -->
            <section class="quiz-section" id="quizSection">
                <!-- Question Navigator Toggle (Mobile) -->
                <button class="quiz-navigator-toggle" id="navToggle">
                    <i class="fas fa-list-ol"></i>
                </button>

                <!-- Question Navigator -->
                <div class="quiz-navigator" id="quizNavigator">
                    <h3 class="navigator-title">
                        <i class="fas fa-compass"></i> Questions Navigator
                    </h3>
                    <div class="question-grid" id="questionGrid">
                        <!-- Question bubbles will be added here -->
                    </div>
                </div>

                <!-- Quiz Header -->
                <div class="quiz-header">
                    <div class="quiz-info">
                        <div class="quiz-title-main" id="quizTitle">
                            <i class="fas fa-graduation-cap"></i>
                            <span id="currentQuizName">Loading Quiz...</span>
                        </div>
                        <div class="quiz-subtitle" id="quizSubtitle">
                            <i class="fas fa-book"></i>
                            Subject: <span id="currentSubject">Extracting...</span>
                        </div>
                    </div>
                    <div class="quiz-stats">
                        <div class="stat-box">
                            <div class="stat-value" id="currentQuestion">1</div>
                            <div class="stat-label">Question</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="totalQuestions">0</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="scoreValue">0</div>
                            <div class="stat-label">Score</div>
                        </div>
                    </div>
                    <div class="timer" id="timer">
                        <i class="fas fa-clock"></i>
                        <span id="timerValue">00:00</span>
                    </div>
                </div>
                
                <!-- Question Container -->
                <div class="question-container">
                    <div class="question-header">
                        <div class="question-number">
                            <i class="fas fa-question-circle"></i>
                            Question <span id="questionNumber">1</span>
                            <span style="font-size: 1rem; margin-left: 10px; opacity: 0.8;" id="pdfQuestionNumber"></span>
                        </div>
                    </div>
                    
                    <div class="question-text" id="questionText">
                        Question will appear here after extraction.
                    </div>
                    
                    <div class="options-container" id="optionsContainer">
                        <!-- Options will be added here -->
                    </div>
                    
                    <div class="solution-container" id="solutionContainer">
                        <div class="solution-title">
                            <i class="fas fa-lightbulb"></i> Solution & Explanation
                            <span style="font-size: 1rem; margin-left: 10px; opacity: 0.8;" id="pdfSolutionNumber"></span>
                        </div>
                        <div class="solution-text" id="solutionText">
                            Solution will appear here when you select an option.
                        </div>
                    </div>
                    
                    <div class="quiz-controls">
                        <button class="quiz-btn prev" id="prevBtn" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <div>
                            <button class="quiz-btn submit" id="submitBtn" style="display: none;">
                                <i class="fas fa-paper-plane"></i> Submit Quiz
                            </button>
                            <button class="quiz-btn next" id="nextBtn">
                                Next <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section" id="resultsSection">
                <div class="results-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <h1 class="results-title">Quiz Completed!</h1>
                <div class="score-display" id="finalScore">0%</div>
                
                <div class="results-stats">
                    <div class="result-stat correct">
                        <span class="value" id="correctCount">0</span>
                        Correct Answers
                    </div>
                    <div class="result-stat incorrect">
                        <span class="value" id="incorrectCount">0</span>
                        Incorrect Answers
                    </div>
                    <div class="result-stat">
                        <span class="value" id="timeTaken">00:00</span>
                        Time Taken
                    </div>
                    <div class="result-stat">
                        <span class="value" id="accuracyRate">0%</span>
                        Accuracy Rate
                    </div>
                </div>
                
                <h3 class="navigator-title">Review Wrong Answers</h3>
                <div class="wrong-questions-container" id="wrongQuestionsContainer">
                    <!-- Wrong questions will be added here -->
                </div>
                
                <div class="result-actions">
                    <button class="quiz-btn prev" id="reviewBtn">
                        <i class="fas fa-redo"></i> Practice Wrong Answers
                    </button>
                    <button class="quiz-btn next" id="backToQuizzesBtn">
                        <i class="fas fa-list"></i> Back to Quizzes
                    </button>
                    <button class="quiz-btn submit" id="downloadBtn">
                        <i class="fas fa-download"></i> Download Results
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Overlay for About & Share -->
    <div class="overlay" id="overlay">
        <div class="overlay-content">
            <h3 class="overlay-title" id="overlayTitle">About Smart PDF Quiz Master</h3>
            <div class="overlay-text" id="overlayText">
                This is an intelligent tool that extracts MCQs from PDFs and creates organized quizzes.
                Upload any PDF with questions (Q.1, Q.2, etc.) and solutions (Sol.1, Sol.2, etc.).
                The system automatically detects subjects, topics, and organizes questions into
                25-question quizzes with detailed analytics and performance tracking.
            </div>
            <div class="overlay-buttons">
                <button class="quiz-btn prev" id="closeOverlayBtn">Close</button>
            </div>
        </div>
    </div>

    <script>
        // PDF.js worker configuration
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js`;

        // Persistent Storage Management
        const StorageManager = {
            STORAGE_KEY: 'pdfQuizMasterData',
            
            saveData: function(data) {
                try {
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
                    return true;
                } catch (e) {
                    console.error('Error saving data:', e);
                    return false;
                }
            },
            
            loadData: function() {
                try {
                    const data = localStorage.getItem(this.STORAGE_KEY);
                    return data ? JSON.parse(data) : { pdfs: [], version: '1.0' };
                } catch (e) {
                    console.error('Error loading data:', e);
                    return { pdfs: [], version: '1.0' };
                }
            },
            
            addPDF: function(pdfData) {
                const data = this.loadData();
                data.pdfs.push(pdfData);
                return this.saveData(data);
            },
            
            updatePDF: function(pdfId, updatedData) {
                const data = this.loadData();
                const index = data.pdfs.findIndex(pdf => pdf.id === pdfId);
                if (index !== -1) {
                    data.pdfs[index] = { ...data.pdfs[index], ...updatedData };
                    return this.saveData(data);
                }
                return false;
            },
            
            deletePDF: function(pdfId) {
                const data = this.loadData();
                data.pdfs = data.pdfs.filter(pdf => pdf.id !== pdfId);
                return this.saveData(data);
            },
            
            updateQuizPerformance: function(pdfId, quizId, score) {
                const data = this.loadData();
                const pdf = data.pdfs.find(pdf => pdf.id === pdfId);
                if (pdf) {
                    const quiz = pdf.quizzes.find(q => q.id === quizId);
                    if (quiz) {
                        // Store only the best score
                        if (!quiz.bestScore || score > quiz.bestScore) {
                            quiz.bestScore = score;
                            quiz.attempts = (quiz.attempts || 0) + 1;
                            quiz.lastAttempt = new Date().toISOString();
                            return this.saveData(data);
                        } else {
                            // Still increment attempts
                            quiz.attempts = (quiz.attempts || 0) + 1;
                            quiz.lastAttempt = new Date().toISOString();
                            return this.saveData(data);
                        }
                    }
                }
                return false;
            },
            
            getPDFById: function(pdfId) {
                const data = this.loadData();
                return data.pdfs.find(pdf => pdf.id === pdfId);
            },
            
            getAllPDFs: function() {
                const data = this.loadData();
                return data.pdfs || [];
            }
        };

        // Enhanced State management
        const state = {
            pdfText: '',
            currentPDF: null,
            currentQuizzes: [],
            subjects: [],
            topics: [],
            currentQuizIndex: 0,
            currentQuestionIndex: 0,
            userAnswers: {},
            quizStarted: false,
            quizCompleted: false,
            timerInterval: null,
            startTime: null,
            elapsedTime: 0,
            totalQuestions: 0,
            correctAnswers: 0,
            incorrectAnswers: 0,
            extractedData: {
                subjects: [],
                topics: [],
                allQuestions: [],
                topicQuestions: {},
                subjectQuestions: {}
            },
            activeSubject: 'All',
            performanceCharts: {}
        };

        // DOM Elements
        const elements = {
            homeLogo: document.getElementById('homeLogo'),
            homeBtn: document.getElementById('homeBtn'),
            pdfFileInput: document.getElementById('pdfFileInput'),
            extractBtn: document.getElementById('extractBtn'),
            loadingIndicator: document.getElementById('loadingIndicator'),
            fileInfo: document.getElementById('fileInfo'),
            homeSection: document.getElementById('homeSection'),
            uploadSection: document.getElementById('uploadSection'),
            librarySection: document.getElementById('librarySection'),
            libraryContainer: document.getElementById('libraryContainer'),
            noQuizzesMessage: document.getElementById('noQuizzesMessage'),
            quizSelectionSection: document.getElementById('quizSelectionSection'),
            quizSection: document.getElementById('quizSection'),
            resultsSection: document.getElementById('resultsSection'),
            subjectFilters: document.getElementById('subjectFilters'),
            quizCardsContainer: document.getElementById('quizCardsContainer'),
            questionText: document.getElementById('questionText'),
            optionsContainer: document.getElementById('optionsContainer'),
            solutionContainer: document.getElementById('solutionContainer'),
            solutionText: document.getElementById('solutionText'),
            currentQuestionElem: document.getElementById('currentQuestion'),
            totalQuestionsElem: document.getElementById('totalQuestions'),
            scoreValueElem: document.getElementById('scoreValue'),
            timerValueElem: document.getElementById('timerValue'),
            timerElem: document.getElementById('timer'),
            questionNumberElem: document.getElementById('questionNumber'),
            pdfQuestionNumber: document.getElementById('pdfQuestionNumber'),
            pdfSolutionNumber: document.getElementById('pdfSolutionNumber'),
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            submitBtn: document.getElementById('submitBtn'),
            finalScoreElem: document.getElementById('finalScore'),
            correctCountElem: document.getElementById('correctCount'),
            incorrectCountElem: document.getElementById('incorrectCount'),
            timeTakenElem: document.getElementById('timeTaken'),
            accuracyRateElem: document.getElementById('accuracyRate'),
            wrongQuestionsContainer: document.getElementById('wrongQuestionsContainer'),
            reviewBtn: document.getElementById('reviewBtn'),
            backToQuizzesBtn: document.getElementById('backToQuizzesBtn'),
            backToLibraryBtn: document.getElementById('backToLibraryBtn'),
            downloadBtn: document.getElementById('downloadBtn'),
            themeToggle: document.getElementById('themeToggle'),
            themeBtn: document.getElementById('themeBtn'),
            drawerToggle: document.getElementById('drawerToggle'),
            sidebar: document.getElementById('sidebar'),
            navToggle: document.getElementById('navToggle'),
            quizNavigator: document.getElementById('quizNavigator'),
            questionGrid: document.getElementById('questionGrid'),
            shareBtn: document.getElementById('shareBtn'),
            aboutBtn: document.getElementById('aboutBtn'),
            overlay: document.getElementById('overlay'),
            overlayTitle: document.getElementById('overlayTitle'),
            overlayText: document.getElementById('overlayText'),
            closeOverlayBtn: document.getElementById('closeOverlayBtn'),
            quizTitle: document.getElementById('currentQuizName'),
            quizSubtitle: document.getElementById('currentSubject')
        };

        // Event Listeners
        elements.homeLogo.addEventListener('click', showHome);
        elements.homeBtn.addEventListener('click', showHome);
        elements.pdfFileInput.addEventListener('change', handleFileSelect);
        elements.extractBtn.addEventListener('click', extractQuestionsFromPDF);
        elements.prevBtn.addEventListener('click', showPreviousQuestion);
        elements.nextBtn.addEventListener('click', showNextQuestion);
        elements.submitBtn.addEventListener('click', submitQuiz);
        elements.reviewBtn.addEventListener('click', reviewWrongAnswers);
        elements.backToQuizzesBtn.addEventListener('click', showQuizSelection);
        elements.backToLibraryBtn.addEventListener('click', showLibrary);
        elements.downloadBtn.addEventListener('click', downloadResults);
        elements.themeToggle.addEventListener('click', toggleTheme);
        elements.themeBtn.addEventListener('click', toggleTheme);
        elements.drawerToggle.addEventListener('click', toggleDrawer);
        elements.navToggle.addEventListener('click', toggleQuizNavigator);
        elements.shareBtn.addEventListener('click', showShareOverlay);
        elements.aboutBtn.addEventListener('click', showAboutOverlay);
        elements.closeOverlayBtn.addEventListener('click', closeOverlay);

        // Initialize
        init();

        function init() {
            // Check for saved theme
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                elements.themeBtn.innerHTML = '<i class="fas fa-sun"></i> Light Mode';
            } else {
                elements.themeBtn.innerHTML = '<i class="fas fa-moon"></i> Dark Mode';
            }
            
            updateFileInfo();
            showHome();
            loadLibrary();
        }

        function showHome() {
            elements.homeSection.style.display = 'block';
            elements.quizSelectionSection.style.display = 'none';
            elements.quizSection.style.display = 'none';
            elements.resultsSection.style.display = 'none';
            
            // Show library if there are PDFs
            const pdfs = StorageManager.getAllPDFs();
            if (pdfs.length > 0) {
                elements.librarySection.style.display = 'block';
                elements.noQuizzesMessage.style.display = 'none';
            } else {
                elements.librarySection.style.display = 'none';
                elements.noQuizzesMessage.style.display = 'block';
            }
        }

        function showLibrary() {
            loadLibrary();
            showHome();
        }

        function loadLibrary() {
            const pdfs = StorageManager.getAllPDFs();
            elements.libraryContainer.innerHTML = '';
            
            if (pdfs.length === 0) {
                elements.noQuizzesMessage.style.display = 'block';
                elements.librarySection.style.display = 'none';
                return;
            }
            
            elements.noQuizzesMessage.style.display = 'none';
            elements.librarySection.style.display = 'block';
            
            pdfs.forEach(pdf => {
                const folder = document.createElement('div');
                folder.className = 'pdf-folder';
                folder.dataset.pdfId = pdf.id;
                
                // Calculate total quizzes
                const totalQuizzes = pdf.quizzes.length;
                const totalQuestions = pdf.quizzes.reduce((sum, quiz) => sum + quiz.questions.length, 0);
                
                // Calculate average performance
                const quizzesWithScores = pdf.quizzes.filter(q => q.bestScore !== undefined);
                const avgScore = quizzesWithScores.length > 0 
                    ? Math.round(quizzesWithScores.reduce((sum, q) => sum + q.bestScore, 0) / quizzesWithScores.length)
                    : 0;
                
                folder.innerHTML = `
                    <div class="folder-header">
                        <div class="folder-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <div class="folder-actions">
                            <button class="folder-action-btn delete-pdf" title="Delete PDF">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <h3 class="folder-name">${pdf.name}</h3>
                    <p style="color: var(--gray); margin-bottom: 1.5rem; font-size: 1.1rem;">
                        <i class="fas fa-calendar"></i> Added: ${new Date(pdf.uploadedAt).toLocaleDateString()}
                    </p>
                    <div class="folder-meta">
                        <div class="meta-item">
                            <span class="meta-value">${totalQuizzes}</span>
                            <span class="meta-label">Quizzes</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-value">${totalQuestions}</span>
                            <span class="meta-label">Questions</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-value">${avgScore}%</span>
                            <span class="meta-label">Avg Score</span>
                        </div>
                    </div>
                    <div class="performance-chart">
                        <canvas id="chart-${pdf.id}" width="300" height="150"></canvas>
                    </div>
                `;
                
                folder.addEventListener('click', (e) => {
                    if (!e.target.closest('.folder-action-btn')) {
                        openPDF(pdf.id);
                    }
                });
                
                // Add delete button event
                const deleteBtn = folder.querySelector('.delete-pdf');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (confirm(`Are you sure you want to delete "${pdf.name}" and all its quizzes?`)) {
                        StorageManager.deletePDF(pdf.id);
                        loadLibrary();
                    }
                });
                
                elements.libraryContainer.appendChild(folder);
                
                // Create performance chart
                setTimeout(() => {
                    createPerformanceChart(pdf);
                }, 100);
            });
        }

        function createPerformanceChart(pdf) {
            const canvasId = `chart-${pdf.id}`;
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Prepare data for chart
            const quizNames = pdf.quizzes.map((q, i) => `Quiz ${i + 1}`);
            const quizScores = pdf.quizzes.map(q => q.bestScore || 0);
            const quizColors = quizScores.map(score => {
                if (score >= 80) return '#06D6A0';
                if (score >= 60) return '#FFD166';
                if (score >= 40) return '#FF9A3D';
                return '#EF476F';
            });
            
            // Destroy existing chart if it exists
            if (state.performanceCharts[pdf.id]) {
                state.performanceCharts[pdf.id].destroy();
            }
            
            // Create new chart
            state.performanceCharts[pdf.id] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: quizNames,
                    datasets: [{
                        label: 'Best Score (%)',
                        data: quizScores,
                        backgroundColor: quizColors,
                        borderColor: quizColors.map(color => color.replace('0.8', '1')),
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Score: ${context.parsed.y}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function openPDF(pdfId) {
            const pdf = StorageManager.getPDFById(pdfId);
            if (!pdf) return;
            
            state.currentPDF = pdf;
            state.currentQuizzes = pdf.quizzes;
            
            // Extract subjects from quizzes
            const subjectsSet = new Set();
            pdf.quizzes.forEach(quiz => {
                if (quiz.subject) subjectsSet.add(quiz.subject);
            });
            state.subjects = ['All', ...Array.from(subjectsSet)];
            
            showQuizSelection();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.type !== 'application/pdf') {
                    alert('Please select a PDF file.');
                    elements.pdfFileInput.value = '';
                    updateFileInfo();
                    elements.extractBtn.disabled = true;
                    return;
                }
                
                updateFileInfo(file);
                elements.extractBtn.disabled = false;
            } else {
                updateFileInfo();
                elements.extractBtn.disabled = true;
            }
        }

        function updateFileInfo(file = null) {
            if (file) {
                elements.fileInfo.textContent = ` ${file.name}  ${(file.size / 1024 / 1024).toFixed(2)} MB`;
                elements.fileInfo.style.color = 'var(--primary)';
            } else {
                elements.fileInfo.textContent = ' No file selected';
                elements.fileInfo.style.color = 'var(--gray)';
            }
        }

        async function extractQuestionsFromPDF() {
            const file = elements.pdfFileInput.files[0];
            if (!file) return;
            
            // Show loading
            elements.extractBtn.disabled = true;
            elements.loadingIndicator.style.display = 'inline-block';
            elements.extractBtn.innerHTML = '<span>Processing PDF...</span>';
            
            try {
                // Read PDF file
                const arrayBuffer = await file.arrayBuffer();
                const typedArray = new Uint8Array(arrayBuffer);
                
                // Load PDF document
                const pdf = await pdfjsLib.getDocument(typedArray).promise;
                
                // Extract text from all pages with better formatting
                let fullText = '';
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    const textContent = await page.getTextContent();
                    
                    // Improved text extraction
                    let pageText = '';
                    let lastY = null;
                    
                    textContent.items.forEach((item, index) => {
                        // Add newline when Y position changes significantly
                        if (lastY !== null && Math.abs(item.transform[5] - lastY) > 3) {
                            pageText += '\n';
                        }
                        pageText += item.str + ' ';
                        lastY = item.transform[5];
                    });
                    
                    fullText += pageText + '\n\n';
                }
                
                state.pdfText = fullText;
                
                // Parse and organize questions
                await parseAndOrganizeQuestions(fullText);
                
                // Create quizzes (25 questions each)
                const quizzes = createQuizzesFromQuestions(state.extractedData.allQuestions);
                
                // Create PDF data object
                const pdfData = {
                    id: 'pdf_' + Date.now(),
                    name: file.name,
                    size: file.size,
                    uploadedAt: new Date().toISOString(),
                    quizzes: quizzes,
                    originalText: fullText.substring(0, 10000) // Store first 10000 chars for reference
                };
                
                // Save to storage
                StorageManager.addPDF(pdfData);
                
                // Update UI
                showHome();
                loadLibrary();
                
                // Clear file input
                elements.pdfFileInput.value = '';
                updateFileInfo();
                
                alert(`Successfully extracted ${state.extractedData.allQuestions.length} questions and created ${quizzes.length} quizzes!`);
                
            } catch (error) {
                console.error('Error extracting PDF:', error);
                alert('Error processing PDF. Please ensure the PDF contains selectable text and try again.');
            } finally {
                // Hide loading
                elements.extractBtn.disabled = false;
                elements.loadingIndicator.style.display = 'none';
                elements.extractBtn.innerHTML = '<span>Extract & Organize Questions</span>';
            }
        }

        async function parseAndOrganizeQuestions(text) {
            state.extractedData = {
                subjects: [],
                topics: [],
                allQuestions: [],
                topicQuestions: {},
                subjectQuestions: {}
            };
            
            // Enhanced patterns for better extraction
            const patterns = {
                question: /(?:Q|Question|QUES|ques||)\.?\s*(\d+)[\.:)\-\]\s*(.*?)(?=(?:Q|Question|QUES|ques||)\.?\s*\d+[\.:)\-\]|(?:Sol|Solution|SOL|sol||)\.?\s*\d+[\.:)\-\]|$)/gis,
                
                solution: /(?:Sol|Solution|SOL|sol||)\.?\s*(\d+)[\.:)\-\]\s*(?:\(?([a-dA-D])\)?)?\s*(.*?)(?=(?:Sol|Solution|SOL|sol||)\.?\s*\d+[\.:)\-\]|(?:Q|Question|QUES|ques||)\.?\s*\d+[\.:)\-\]|$)/gis
            };
            
            // Extract all questions
            let questionMatch;
            const questionsMap = new Map();
            
            patterns.question.lastIndex = 0;
            while ((questionMatch = patterns.question.exec(text)) !== null) {
                const questionNum = parseInt(questionMatch[1].replace(/[^0-9]/g, ''));
                let questionText = questionMatch[2].trim();
                
                // Clean up question text
                questionText = questionText.replace(/\s+/g, ' ').replace(/\n/g, ' ');
                
                // Extract options (multiple patterns)
                const optionPatterns = [
                    /\(([a-d])\)\s*(.*?)(?=\([a-d]\)|$)/g,
                    /([a-d])\.\s*(.*?)(?=[a-d]\.|$)/g,
                    /([a-d])\s*[\)\-]\s*(.*?)(?=[a-d]\s*[\)\-]|$)/g
                ];
                
                const options = [];
                let optionsFound = false;
                
                for (const pattern of optionPatterns) {
                    pattern.lastIndex = 0;
                    let optionMatch;
                    while ((optionMatch = pattern.exec(questionText)) !== null) {
                        let optionId = optionMatch[1].toLowerCase();
                        options.push({
                            id: optionId,
                            text: optionMatch[2].trim()
                        });
                        optionsFound = true;
                    }
                    if (optionsFound) break;
                }
                
                // Remove options from question text for cleaner display
                if (options.length > 0) {
                    questionText = questionText.replace(/\([a-d]\)\s*.*?(?=\([a-d]\)|$)/g, '')
                                                .replace(/[a-d]\.\s*.*?(?=[a-d]\.|$)/g, '')
                                                .trim();
                }
                
                questionsMap.set(questionNum, {
                    id: questionNum,
                    text: questionText,
                    options: options,
                    correctAnswer: null,
                    solution: null,
                    topic: 'General',
                    subject: 'General'
                });
            }
            
            // Extract all solutions
            patterns.solution.lastIndex = 0;
            let solutionMatch;
            while ((solutionMatch = patterns.solution.exec(text)) !== null) {
                const questionNum = parseInt(solutionMatch[1].replace(/[^0-9]/g, ''));
                let correctAnswer = solutionMatch[2] ? solutionMatch[2].toLowerCase() : null;
                const solutionText = solutionMatch[3] ? solutionMatch[3].trim() : '';
                
                if (questionsMap.has(questionNum)) {
                    const question = questionsMap.get(questionNum);
                    question.correctAnswer = correctAnswer;
                    question.solution = solutionText;
                    question.solutionNumber = questionNum; // Store solution number
                }
            }
            
            // Convert map to array and sort
            state.extractedData.allQuestions = Array.from(questionsMap.values())
                .filter(q => q.text.length > 10) // Filter out very short questions
                .sort((a, b) => a.id - b.id);
            
            // Auto-detect subjects based on keywords
            const subjectKeywords = {
                'Mathematics': ['math', 'algebra', 'geometry', 'calculus', 'equation', 'formula'],
                'Science': ['science', 'physics', 'chemistry', 'biology', 'atom', 'molecule'],
                'History': ['history', 'historical', 'century', 'war', 'king', 'empire'],
                'Geography': ['geography', 'map', 'country', 'river', 'mountain', 'climate'],
                'English': ['english', 'grammar', 'vocabulary', 'sentence', 'paragraph', 'essay'],
                'General Knowledge': ['general knowledge', 'gk', 'current affairs', 'static']
            };
            
            state.extractedData.allQuestions.forEach(question => {
                const questionText = question.text.toLowerCase();
                for (const [subject, keywords] of Object.entries(subjectKeywords)) {
                    if (keywords.some(keyword => questionText.includes(keyword.toLowerCase()))) {
                        question.subject = subject;
                        break;
                    }
                }
                if (!question.subject) question.subject = 'General Knowledge';
            });
        }

        function createQuizzesFromQuestions(questions) {
            const quizzes = [];
            const chunkSize = 25;
            
            // Group questions by subject first
            const questionsBySubject = {};
            questions.forEach(q => {
                if (!questionsBySubject[q.subject]) {
                    questionsBySubject[q.subject] = [];
                }
                questionsBySubject[q.subject].push(q);
            });
            
            // Create quizzes from each subject group
            Object.entries(questionsBySubject).forEach(([subject, subjectQuestions]) => {
                // Split into chunks of 25
                for (let i = 0; i < subjectQuestions.length; i += chunkSize) {
                    const chunk = subjectQuestions.slice(i, i + chunkSize);
                    const quizNumber = quizzes.length + 1;
                    
                    quizzes.push({
                        id: `quiz_${Date.now()}_${quizNumber}`,
                        name: `${subject} - Quiz ${Math.floor(i/chunkSize) + 1}`,
                        subject: subject,
                        questions: chunk,
                        totalQuestions: chunk.length,
                        bestScore: 0,
                        attempts: 0,
                        lastAttempt: null
                    });
                }
            });
            
            // If we have less than chunkSize questions, create one quiz
            if (quizzes.length === 0 && questions.length > 0) {
                quizzes.push({
                    id: `quiz_${Date.now()}_1`,
                    name: 'General Quiz 1',
                    subject: 'General Knowledge',
                    questions: questions.slice(0, chunkSize),
                    totalQuestions: Math.min(questions.length, chunkSize),
                    bestScore: 0,
                    attempts: 0,
                    lastAttempt: null
                });
            }
            
            return quizzes;
        }

        function showQuizSelection() {
            elements.homeSection.style.display = 'none';
            elements.quizSection.style.display = 'none';
            elements.resultsSection.style.display = 'none';
            elements.quizSelectionSection.style.display = 'block';
            
            updateSubjectFilters();
            updateQuizCards();
        }

        function updateSubjectFilters() {
            elements.subjectFilters.innerHTML = '';
            
            state.subjects.forEach(subject => {
                const filter = document.createElement('button');
                filter.className = `subject-filter ${subject === state.activeSubject ? 'active' : ''}`;
                filter.textContent = subject;
                filter.addEventListener('click', () => {
                    state.activeSubject = subject;
                    updateSubjectFilters();
                    updateQuizCards();
                });
                elements.subjectFilters.appendChild(filter);
            });
        }

        function updateQuizCards() {
            elements.quizCardsContainer.innerHTML = '';
            
            const filteredQuizzes = state.activeSubject === 'All' 
                ? state.currentQuizzes 
                : state.currentQuizzes.filter(q => q.subject === state.activeSubject);
            
            if (filteredQuizzes.length === 0) {
                elements.quizCardsContainer.innerHTML = `
                    <div style="text-align: center; padding: 4rem; color: var(--gray);">
                        <i class="fas fa-search fa-3x" style="margin-bottom: 1.5rem;"></i>
                        <h3 style="margin-bottom: 1rem;">No quizzes found for "${state.activeSubject}"</h3>
                        <p>Try selecting a different subject.</p>
                    </div>
                `;
                return;
            }
            
            filteredQuizzes.forEach((quiz, index) => {
                const card = document.createElement('div');
                card.className = 'quiz-card';
                card.dataset.quizIndex = index;
                
                const bestScore = quiz.bestScore || 0;
                const attempts = quiz.attempts || 0;
                
                card.innerHTML = `
                    <div class="quiz-card-header">
                        <div class="quiz-number">Quiz #${index + 1}</div>
                        <div class="quiz-badge">${quiz.subject}</div>
                    </div>
                    <h3 class="quiz-title">${quiz.name}</h3>
                    <p style="color: var(--gray); margin-bottom: 1.5rem; font-size: 1.1rem;">
                        <i class="fas fa-question-circle"></i> ${quiz.totalQuestions} Questions
                    </p>
                    <div class="quiz-performance">
                        <div class="performance-score">${bestScore}%</div>
                        <div class="performance-label">Best Score (${attempts} attempts)</div>
                    </div>
                    <div class="quiz-meta">
                        <div class="meta-item">
                            <span class="meta-value">${quiz.totalQuestions}</span>
                            <span class="meta-label">Questions</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-value">25</span>
                            <span class="meta-label">Max per Quiz</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-value">${attempts}</span>
                            <span class="meta-label">Attempts</span>
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    startQuiz(index);
                });
                
                elements.quizCardsContainer.appendChild(card);
            });
        }

        function startQuiz(quizIndex) {
            if (quizIndex < 0 || quizIndex >= state.currentQuizzes.length) return;
            
            state.currentQuizIndex = quizIndex;
            state.currentQuestionIndex = 0;
            state.userAnswers = {};
            state.quizStarted = true;
            state.quizCompleted = false;
            state.elapsedTime = 0;
            state.correctAnswers = 0;
            state.incorrectAnswers = 0;
            
            // Update UI
            elements.quizSelectionSection.style.display = 'none';
            elements.quizSection.style.display = 'block';
            elements.resultsSection.style.display = 'none';
            
            // Update quiz info
            const currentQuiz = state.currentQuizzes[state.currentQuizIndex];
            elements.quizTitle.textContent = currentQuiz.name;
            elements.quizSubtitle.innerHTML = `<i class="fas fa-book"></i> Subject: <span id="currentSubject">${currentQuiz.subject}</span>`;
            
            // Start timer
            startTimer();
            
            // Display first question
            displayCurrentQuestion();
            updateQuestionGrid();
        }

        function updateQuestionGrid() {
            elements.questionGrid.innerHTML = '';
            
            const currentQuiz = state.currentQuizzes[state.currentQuizIndex];
            if (!currentQuiz) return;
            
            currentQuiz.questions.forEach((question, index) => {
                const bubble = document.createElement('div');
                bubble.className = 'question-bubble';
                
                if (index === state.currentQuestionIndex) {
                    bubble.classList.add('active');
                }
                
                const questionId = question.id;
                const userAnswer = state.userAnswers[questionId];
                if (userAnswer !== undefined) {
                    if (userAnswer === question.correctAnswer) {
                        bubble.classList.add('answered');
                    } else {
                        bubble.classList.add('wrong');
                    }
                }
                
                bubble.textContent = index + 1;
                bubble.title = `Question ${index + 1}`;
                
                bubble.addEventListener('click', () => {
                    state.currentQuestionIndex = index;
                    displayCurrentQuestion();
                    updateQuestionGrid();
                });
                
                elements.questionGrid.appendChild(bubble);
            });
        }

        function displayCurrentQuestion() {
            const currentQuiz = state.currentQuizzes[state.currentQuizIndex];
            if (!currentQuiz || state.currentQuestionIndex >= currentQuiz.questions.length) return;
            
            const question = currentQuiz.questions[state.currentQuestionIndex];
            
            // Update question display
            elements.questionNumberElem.textContent = state.currentQuestionIndex + 1;
            elements.questionText.textContent = question.text;
            elements.currentQuestionElem.textContent = state.currentQuestionIndex + 1;
            elements.totalQuestionsElem.textContent = currentQuiz.questions.length;
            
            // Show PDF question number
            elements.pdfQuestionNumber.textContent = `(PDF Q.${question.id})`;
            
            // Clear and create options
            elements.optionsContainer.innerHTML = '';
            
            if (question.options && question.options.length > 0) {
                question.options.forEach(option => {
                    const optionElem = document.createElement('div');
                    optionElem.className = 'option';
                    
                    const questionId = question.id;
                    const userAnswer = state.userAnswers[questionId];
                    if (userAnswer === option.id) {
                        optionElem.classList.add('selected');
                    }
                    
                    optionElem.innerHTML = `
                        <div class="option-letter">${option.id.toUpperCase()}</div>
                        <div class="option-text">${option.text}</div>
                    `;
                    
                    optionElem.addEventListener('click', () => selectOption(questionId, option.id));
                    elements.optionsContainer.appendChild(optionElem);
                });
            } else {
                elements.optionsContainer.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--warning);">
                        <i class="fas fa-exclamation-triangle fa-3x" style="margin-bottom: 1.5rem;"></i>
                        <h3 style="margin-bottom: 1rem;">No Options Available</h3>
                        <p>This question doesn't have multiple choice options.</p>
                    </div>
                `;
            }
            
            // Update navigation buttons
            elements.prevBtn.disabled = state.currentQuestionIndex === 0;
            const isLastQuestion = state.currentQuestionIndex === currentQuiz.questions.length - 1;
            
            elements.nextBtn.disabled = isLastQuestion;
            elements.nextBtn.style.display = isLastQuestion ? 'none' : 'inline-flex';
            elements.submitBtn.style.display = isLastQuestion ? 'inline-flex' : 'none';
            
            // Show solution if already answered
            if (state.userAnswers[question.id] !== undefined) {
                showSolution(question);
            } else {
                elements.solutionContainer.style.display = 'none';
            }
            
            // Update score
            updateScore();
        }

        function selectOption(questionId, optionId) {
            // Remove selection from all options
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selection to clicked option
            event.target.closest('.option').classList.add('selected');
            
            // Store answer
            state.userAnswers[questionId] = optionId;
            
            // Show solution immediately
            const currentQuiz = state.currentQuizzes[state.currentQuizIndex];
            const question = currentQuiz.questions.find(q => q.id === questionId);
            if (question) {
                showSolution(question);
                updateScore();
                updateQuestionGrid();
            }
        }

        function showSolution(question) {
            if (!question.solution && !question.correctAnswer) return;
            
            // Show PDF solution number
            if (question.solutionNumber) {
                elements.pdfSolutionNumber.textContent = `(PDF Sol.${question.solutionNumber})`;
            }
            
            let solutionHTML = '';
            if (question.correctAnswer) {
                solutionHTML += `<p style="margin-bottom: 1rem;"><strong style="color: var(--success);"> Correct Answer:</strong> <span style="font-weight: 800; font-size: 1.2rem;">${question.correctAnswer.toUpperCase()}</span></p>`;
            }
            if (question.solution) {
                solutionHTML += `<p>${question.solution}</p>`;
            } else {
                solutionHTML += `<p style="color: var(--gray); font-style: italic;">No detailed solution available for this question.</p>`;
            }
            
            elements.solutionText.innerHTML = solutionHTML;
            elements.solutionContainer.style.display = 'block';
            
            // Highlight correct/incorrect answers
            const userAnswer = state.userAnswers[question.id];
            if (userAnswer && question.correctAnswer) {
                document.querySelectorAll('.option').forEach(opt => {
                    const optionLetter = opt.querySelector('.option-letter').textContent.toLowerCase();
                    opt.classList.remove('correct', 'incorrect');
                    
                    if (optionLetter === question.correctAnswer) {
                        opt.classList.add('correct');
                    } else if (optionLetter === userAnswer && userAnswer !== question.correctAnswer) {
                        opt.classList.add('incorrect');
                    }
                });
            }
        }

        function showPreviousQuestion() {
            if (state.currentQuestionIndex > 0) {
                state.currentQuestionIndex--;
                displayCurrentQuestion();
                updateQuestionGrid();
            }
        }

        function showNextQuestion() {
            const currentQuiz = state.currentQuizzes[state.currentQuizIndex];
            if (state.currentQuestionIndex < currentQuiz.questions.length - 1) {
                state.currentQuestionIndex++;
                displayCurrentQuestion();
                updateQuestionGrid();
            }
        }

        function startTimer() {
            state.startTime = Date.now();
            
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
            }
            
            state.timerInterval = setInterval(() => {
                state.elapsedTime = Math.floor((Date.now() - state.startTime) / 1000);
                
                const minutes = Math.floor(state.elapsedTime / 60);
                const seconds = state.elapsedTime % 60;
                
                elements.timerValueElem.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Add warning after 20 minutes
                if (state.elapsedTime > 1200) {
                    elements.timerElem.classList.add('warning');
                }
            }, 1000);
        }

        function updateScore() {
            const currentQuiz = state.currentQuizzes[state.currentQuizIndex];
            let correct = 0;
            let answered = 0;
            
            currentQuiz.questions.forEach(question => {
                const userAnswer = state.userAnswers[question.id];
                if (userAnswer !== undefined) {
                    answered++;
                    if (userAnswer === question.correctAnswer) {
                        correct++;
                    }
                }
            });
            
            const score = answered > 0 ? Math.round((correct / answered) * 100) : 0;
            elements.scoreValueElem.textContent = score;
        }

        function submitQuiz() {
            // Stop timer
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
                state.timerInterval = null;
            }
            
            const currentQuiz = state.currentQuizzes[state.currentQuizIndex];
            let correct = 0;
            let total = currentQuiz.questions.length;
            
            currentQuiz.questions.forEach(question => {
                if (state.userAnswers[question.id] === question.correctAnswer) {
                    correct++;
                }
            });
            
            state.correctAnswers = correct;
            state.incorrectAnswers = total - correct;
            state.quizCompleted = true;
            
            // Calculate score percentage
            const score = Math.round((correct / total) * 100);
            
            // Update performance in storage
            StorageManager.updateQuizPerformance(
                state.currentPDF.id, 
                currentQuiz.id, 
                score
            );
            
            // Show results
            showResults();
        }

        function showResults() {
            elements.quizSection.style.display = 'none';
            elements.resultsSection.style.display = 'block';
            
            const currentQuiz = state.currentQuizzes[state.currentQuizIndex];
            const total = currentQuiz.questions.length;
            const correct = state.correctAnswers;
            const score = Math.round((correct / total) * 100);
            
            // Update results display
            elements.finalScoreElem.textContent = `${score}%`;
            elements.correctCountElem.textContent = correct;
            elements.incorrectCountElem.textContent = state.incorrectAnswers;
            elements.accuracyRateElem.textContent = `${score}%`;
            
            const minutes = Math.floor(state.elapsedTime / 60);
            const seconds = state.elapsedTime % 60;
            elements.timeTakenElem.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Display wrong questions
            displayWrongQuestions();
        }

        function displayWrongQuestions() {
            elements.wrongQuestionsContainer.innerHTML = '';
            
            const currentQuiz = state.currentQuizzes[state.currentQuizIndex];
            const wrongQuestions = currentQuiz.questions.filter(q => 
                state.userAnswers[q.id] !== undefined && 
                state.userAnswers[q.id] !== q.correctAnswer
            );
            
            if (wrongQuestions.length === 0) {
                elements.wrongQuestionsContainer.innerHTML = `
                    <div style="text-align: center; padding: 4rem; color: var(--success);">
                        <i class="fas fa-check-circle fa-4x" style="margin-bottom: 1.5rem;"></i>
                        <h3 style="margin-bottom: 1rem; font-size: 2rem;">Perfect Score! </h3>
                        <p style="font-size: 1.2rem;">All answers are correct! Excellent work!</p>
                    </div>
                `;
                return;
            }
            
            wrongQuestions.forEach((question, index) => {
                const questionElem = document.createElement('div');
                questionElem.className = 'question-container';
                questionElem.style.marginBottom = '2rem';
                questionElem.style.animationDelay = `${index * 0.1}s`;
                
                const userAnswer = state.userAnswers[question.id];
                const correctAnswer = question.correctAnswer;
                
                let optionsHTML = '';
                if (question.options && question.options.length > 0) {
                    question.options.forEach(opt => {
                        let optionClass = '';
                        if (opt.id === correctAnswer) {
                            optionClass = 'correct';
                        } else if (opt.id === userAnswer) {
                            optionClass = 'incorrect';
                        }
                        
                        optionsHTML += `
                            <div class="option ${optionClass}" style="margin-bottom: 0.8rem;">
                                <div class="option-letter">${opt.id.toUpperCase()}</div>
                                <div class="option-text">${opt.text}</div>
                            </div>
                        `;
                    });
                }
                
                questionElem.innerHTML = `
                    <div class="question-header">
                        <div class="question-number">
                            <i class="fas fa-exclamation-circle"></i>
                            Question ${index + 1}
                            <span style="font-size: 1rem; margin-left: 10px; opacity: 0.8;">(PDF Q.${question.id})</span>
                        </div>
                    </div>
                    <div class="question-text">${question.text}</div>
                    <div style="margin: 2rem 0;">
                        ${optionsHTML}
                        <div class="solution-container" style="display: block; margin-top: 2rem;">
                            <div class="solution-title">
                                <i class="fas fa-graduation-cap"></i> Detailed Explanation
                                <span style="font-size: 1rem; margin-left: 10px; opacity: 0.8;">(PDF Sol.${question.solutionNumber || question.id})</span>
                            </div>
                            <div class="solution-text">
                                <p><strong style="color: var(--danger);"> Your Answer:</strong> ${userAnswer ? userAnswer.toUpperCase() : 'Not answered'}</p>
                                <p><strong style="color: var(--success);"> Correct Answer:</strong> ${correctAnswer ? correctAnswer.toUpperCase() : 'Not available'}</p>
                                ${question.solution ? `<p style="margin-top: 1rem;">${question.solution}</p>` : ''}
                            </div>
                        </div>
                    </div>
                `;
                
                elements.wrongQuestionsContainer.appendChild(questionElem);
            });
        }

        function reviewWrongAnswers() {
            // Find wrong questions in current quiz
            const currentQuiz = state.currentQuizzes[state.currentQuizIndex];
            const wrongQuestions = currentQuiz.questions.filter(q => 
                state.userAnswers[q.id] !== undefined && 
                state.userAnswers[q.id] !== q.correctAnswer
            );
            
            if (wrongQuestions.length === 0) {
                alert('No wrong answers to review!');
                return;
            }
            
            // Create a new quiz with wrong questions (max 25)
            const reviewQuestions = wrongQuestions.slice(0, 25);
            const reviewQuiz = {
                id: `review_${Date.now()}`,
                name: `Review: ${currentQuiz.name}`,
                subject: currentQuiz.subject,
                questions: reviewQuestions,
                totalQuestions: reviewQuestions.length,
                isReview: true
            };
            
            // Add to current quizzes temporarily
            state.currentQuizzes.push(reviewQuiz);
            state.currentQuizIndex = state.currentQuizzes.length - 1;
            state.currentQuestionIndex = 0;
            state.quizCompleted = false;
            
            // Reset answers for review quiz
            reviewQuestions.forEach(q => {
                delete state.userAnswers[q.id];
            });
            
            // Update UI
            displayCurrentQuestion();
            updateQuestionGrid();
            
            elements.resultsSection.style.display = 'none';
            elements.quizSection.style.display = 'block';
            
            // Update quiz info
            elements.quizTitle.textContent = reviewQuiz.name;
            elements.quizSubtitle.innerHTML = `<i class="fas fa-book"></i> Subject: <span id="currentSubject">${reviewQuiz.subject}</span>`;
            
            // Restart timer
            startTimer();
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('darkMode', 'true');
                elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                elements.themeBtn.innerHTML = '<i class="fas fa-sun"></i> Light Mode';
            } else {
                localStorage.setItem('darkMode', 'false');
                elements.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                elements.themeBtn.innerHTML = '<i class="fas fa-moon"></i> Dark Mode';
            }
        }

        function toggleDrawer() {
            elements.sidebar.classList.toggle('open');
            elements.drawerToggle.innerHTML = elements.sidebar.classList.contains('open') 
                ? '<i class="fas fa-times"></i>' 
                : '<i class="fas fa-bars"></i>';
        }

        function toggleQuizNavigator() {
            elements.quizNavigator.classList.toggle('show');
        }

        function showShareOverlay() {
            elements.overlayTitle.textContent = 'Share Smart PDF Quiz Master';
            elements.overlayText.innerHTML = `
                <p>Share this amazing quiz tool with others:</p>
                <div style="margin: 2rem 0;">
                    <input type="text" id="shareUrl" readonly 
                           style="width: 100%; padding: 1rem; border: 2px solid var(--primary); border-radius: 10px; font-size: 1.1rem;"
                           value="${window.location.href}">
                    <button onclick="copyShareUrl()" 
                            style="margin-top: 1rem; padding: 0.8rem 1.5rem; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 700;">
                        <i class="fas fa-copy"></i> Copy Link
                    </button>
                </div>
                <p>Or share via social media:</p>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button class="sidebar-btn" style="flex: 1; padding: 1rem;" onclick="shareVia('facebook')">
                        <i class="fab fa-facebook"></i> Facebook
                    </button>
                    <button class="sidebar-btn" style="flex: 1; padding: 1rem;" onclick="shareVia('twitter')">
                        <i class="fab fa-twitter"></i> Twitter
                    </button>
                    <button class="sidebar-btn" style="flex: 1; padding: 1rem;" onclick="shareVia('whatsapp')">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </button>
                </div>
            `;
            elements.overlay.style.display = 'flex';
        }

        function showAboutOverlay() {
            elements.overlayTitle.textContent = 'About Smart PDF Quiz Master';
            elements.overlayText.innerHTML = `
                <p><strong>Smart PDF Quiz Master</strong> is an advanced tool that intelligently extracts Multiple Choice Questions from PDF files and converts them into interactive quizzes.</p>
                
                <h4 style="margin-top: 2rem; color: var(--primary);"> Key Features:</h4>
                <ul style="margin-left: 1.5rem; margin-bottom: 2rem; font-size: 1.1rem;">
                    <li>Smart extraction of questions and solutions from any PDF</li>
                    <li>Automatic subject and topic detection</li>
                    <li>Organizes questions into 25-question quizzes</li>
                    <li>Permanent storage of PDFs and quizzes</li>
                    <li>Performance tracking with best scores</li>
                    <li>Beautiful question navigator with visual indicators</li>
                    <li>Colorful, responsive design with dark/light mode</li>
                    <li>Detailed analytics and performance tracking</li>
                    <li>Review wrong answers with explanations</li>
                    <li>Support for PDF question numbers (Q.1, Q.2) and solution numbers (Sol.1, Sol.2)</li>
                </ul>
                
                <p><strong> How to use:</strong> Upload any PDF containing questions in formats like "Q.1. Question text..." and solutions like "Sol.1.(c) Solution text...". The system automatically organizes everything.</p>
                
                <p style="margin-top: 2rem; font-size: 0.9rem; color: var(--gray);">
                    <i class="fas fa-code"></i> Built with HTML, CSS, JavaScript & PDF.js
                </p>
            `;
            elements.overlay.style.display = 'flex';
        }

        function closeOverlay() {
            elements.overlay.style.display = 'none';
        }

        function downloadResults() {
            const currentQuiz = state.currentQuizzes[state.currentQuizIndex];
            const results = {
                quizDate: new Date().toISOString(),
                quizName: currentQuiz.name,
                subject: currentQuiz.subject,
                totalQuestions: currentQuiz.questions.length,
                correctAnswers: state.correctAnswers,
                incorrectAnswers: state.incorrectAnswers,
                score: Math.round((state.correctAnswers / currentQuiz.questions.length) * 100),
                timeTaken: state.elapsedTime,
                questions: currentQuiz.questions.map(q => ({
                    id: q.id,
                    text: q.text,
                    userAnswer: state.userAnswers[q.id],
                    correctAnswer: q.correctAnswer,
                    isCorrect: state.userAnswers[q.id] === q.correctAnswer,
                    solution: q.solution
                }))
            };
            
            const dataStr = JSON.stringify(results, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `quiz-results-${currentQuiz.name.replace(/[^a-z0-9]/gi, '-').toLowerCase()}-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Global functions for overlay
        window.copyShareUrl = function() {
            const shareUrlInput = document.getElementById('shareUrl');
            shareUrlInput.select();
            document.execCommand('copy');
            alert('Link copied to clipboard!');
        };

        window.shareVia = function(platform) {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent('Check out Smart PDF Quiz Master - An amazing quiz tool!');
            
            let shareUrl;
            switch(platform) {
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                    break;
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
                    break;
                case 'whatsapp':
                    shareUrl = `https://wa.me/?text=${title}%20${url}`;
                    break;
                default:
                    return;
            }
            
            window.open(shareUrl, '_blank', 'width=600,height=400');
        };

        // Close drawer when clicking outside on mobile
        document.addEventListener('click', (event) => {
            if (window.innerWidth <= 768 && 
                !elements.sidebar.contains(event.target) && 
                !elements.drawerToggle.contains(event.target) && 
                elements.sidebar.classList.contains('open')) {
                toggleDrawer();
            }
            
            // Close quiz navigator when clicking outside on mobile
            if (window.innerWidth <= 768 && 
                !elements.quizNavigator.contains(event.target) && 
                !elements.navToggle.contains(event.target) && 
                elements.quizNavigator.classList.contains('show')) {
                toggleQuizNavigator();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            if (elements.quizSection.style.display === 'block') {
                switch(event.key) {
                    case 'ArrowLeft':
                        if (!elements.prevBtn.disabled) showPreviousQuestion();
                        break;
                    case 'ArrowRight':
                        if (!elements.nextBtn.disabled) showNextQuestion();
                        break;
                    case '1':
                    case '2':
                    case '3':
                    case '4':
                        const optionIndex = parseInt(event.key) - 1;
                        const options = document.querySelectorAll('.option');
                        if (options[optionIndex]) {
                            options[optionIndex].click();
                        }
                        break;
                }
            }
        });
    </script>
</body>
</html>